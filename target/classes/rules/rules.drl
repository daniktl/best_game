package com.drools.best_game
//import com.drools.best_game.BestGame.Question
import com.drools.best_game.MainGUI
import com.drools.best_game.ResultFrame
import com.drools.best_game.QuestionFrame
//import function com.drools.best_game.BestGame.askQuestion

import javax.swing.JFrame
import javax.swing.JOptionPane
import java.awt.Rectangle
import com.google.gson.Gson
import java.io.InputStream
import com.google.gson.stream.JsonReader
import java.io.BufferedReader
import java.io.InputStreamReader
import com.drools.best_game.BestGame
import java.util.ArrayList


declare Question
    q: String
    shortcut: String
    possibleAnswers: String[]
    answer: String
end;


function void showResult(String result){
    ResultFrame rf = new ResultFrame(result);
    rf.show();
}

function void askQuestion(Question q){
    QuestionFrame qf = new QuestionFrame(q.getQ(), q.getPossibleAnswers());
    qf.show();
}


//function void askQuestion(Question q){
//    JFrame frame = MainGUI.getFrame();
//    int answer_idx = JOptionPane.showOptionDialog(frame,
//            q.getQ(),
//            "Answer the question",
//            JOptionPane.DEFAULT_OPTION,
//            JOptionPane.QUESTION_MESSAGE,
//            null,
//            q.getPossibleAnswers(),
//            q.getPossibleAnswers()[0]
//    );
//    q.setAnswer(q.getPossibleAnswers()[answer_idx]);
//}


rule "init"
when

then
    Gson gson = new Gson();
    InputStream is = BestGame.class.getResourceAsStream("/q.json");
    JsonReader reader = new JsonReader(new BufferedReader(new InputStreamReader(is)));

    Question[] questions = gson.fromJson(reader, Question[].class);

    for (Question q: questions) {
        insert(q);
    }
end

rule "less then two hours"
when
    // check if already passed main frame
    // MainFrame(started == true)
    Question(getShortcut() == "2 hours", getAnswer() == "No")
    $q : Question(getShortcut() == "nerd", getAnswer() == null)
then
    askQuestion($q);
    update($q);

end

rule "nerd"
when
    Question(getShortcut() == "nerd", getAnswer() == "Yes")
    $q: Question(getShortcut() == "spend hours preparing", getAnswer() == null)
then
    askQuestion($q);
    update($q);
end

rule "spend hours preparing"
when
    $q: Question(getShortcut() == "spend hours preparing", getAnswer() == "Yes")
then
    showResult("Warcaby");
end

