package com.drools.best_game
import com.drools.best_game.BestGame.Question
import com.drools.best_game.BestGame.MainFrame
import javax.swing.JFrame
import javax.swing.JOptionPane
import java.awt.Rectangle
import com.google.gson.Gson
import java.io.InputStream
import com.google.gson.stream.JsonReader
import java.io.BufferedReader
import java.io.InputStreamReader
import com.drools.best_game.BestGame


function void askQuestion(Question q){
    JFrame frame = new JFrame();
    int answer_idx = JOptionPane.showOptionDialog(frame,
            q.getQ(),
            "Answer the question",
            JOptionPane.DEFAULT_OPTION,
            JOptionPane.QUESTION_MESSAGE,
            null,
            q.getPossibleAnswers(),
            q.getPossibleAnswers()[0]
    );
    q.setAnswer(q.getPossibleAnswers()[answer_idx]);
}



rule "init"
when

then
    Gson gson = new Gson();
    InputStream is = BestGame.class.getResourceAsStream("/q.json");
    JsonReader reader = new JsonReader(new BufferedReader(new InputStreamReader(is)));

    Question[] questions = gson.fromJson(reader, Question[].class);

    for (Question q: questions) {
        insert(q);
    }
//    MainFrame main_frame = new MainFrame();
//    insert(main_frame);
end

rule "less then two hours"
when
    // check if already passed main frame
    // MainFrame(started == true)
    Question(getShortcut() == "2 hours", getAnswer() == "No")
    $q : Question(getShortcut() == "nerd", getAnswer() == null)
then
    Question q_tmp = $q;
    q_tmp.ask();
    delete($q);
    insert(q_tmp);
end

rule "nerd"
when
    Question(getShortcut() == "nerd", getAnswer() == "Yes")
    $q: Question(getShortcut() == "hours preparing", getAnswer() == null)
then
    askQuestion($q);
end